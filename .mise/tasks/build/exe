#!/usr/bin/env bash
#MISE description="Build a deb package"
#MISE depends=["build:wheel", "build:docker:windows"]
set -e
docker run \
    --name maws-nuitka-builder-volume-helper \
    --rm \
    -t \
    --user root \
    -v maws-nuitka-exe-builder-cache:/ccache \
    nuitka:wine \
    chown -R builder: /ccache
docker run \
    --name maws-nuitka-builder \
    --rm \
    -t \
    -v "${PWD}":/source \
    -v maws-nuitka-exe-builder-cache:/python/prefix/drive_c/users/builder/AppData/Local/Nuitka/Nuitka/Cache/ccache \
    nuitka:wine \
    sh -c 'echo -e "from maws.main import app\n\napp()" >cli.py; wine cmd /c pip install /source && wine python -m nuitka --assume-yes-for-downloads -o z:/builddir/maws.exe --onefile z:/builddir/cli.py && cp maws.exe /source'
